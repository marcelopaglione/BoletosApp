<mat-accordion>
  <mat-expansion-panel [expanded]="true" #panel1>
    <div>
      <button mat-flat-button color="primary" (click)="limparForm();panel2.expanded = true;">Criar Novo Cliente</button>
    </div>
    <mat-expansion-panel-header>
      <mat-panel-title>
        Clientes
      </mat-panel-title>
      <mat-panel-description>
        Administrar Clientes
      </mat-panel-description>
    </mat-expansion-panel-header>
    <div *ngIf="clientes$ | async as clientes">
      <table mat-table [dataSource]="clientes" class="mat-elevation-z8">

        <ng-container matColumnDef="id">
          <th mat-header-cell *matHeaderCellDef> ID </th>
          <td mat-cell *matCellDef="let element"> {{element.id}} </td>
        </ng-container>

        <ng-container matColumnDef="nome">
          <th mat-header-cell *matHeaderCellDef> Nome </th>
          <td mat-cell *matCellDef="let element"> {{element.nome}} </td>
        </ng-container>

        <ng-container matColumnDef="email">
          <th mat-header-cell *matHeaderCellDef> Email </th>
          <td mat-cell *matCellDef="let element"> {{element.email}} </td>
        </ng-container>

        <ng-container matColumnDef="telefone">
          <th mat-header-cell *matHeaderCellDef> Telefone </th>
          <td mat-cell *matCellDef="let element"> {{element.telefone | phone}} </td>
        </ng-container>

        <ng-container matColumnDef="valor">
          <th mat-header-cell *matHeaderCellDef> Valor do Aluguel </th>
          <td mat-cell *matCellDef="let element"> {{element.valor | currency:'BRL'}} </td>
        </ng-container>

        <ng-container matColumnDef="cep">
          <th mat-header-cell *matHeaderCellDef> Cep </th>
          <td mat-cell *matCellDef="let element"> {{element.endereco.cep}} </td>
        </ng-container>

        <ng-container matColumnDef="rua">
          <th mat-header-cell *matHeaderCellDef> Rua </th>
          <td mat-cell *matCellDef="let element"> {{element.endereco.rua}} </td>
        </ng-container>

        <ng-container matColumnDef="numero">
          <th mat-header-cell *matHeaderCellDef> Número </th>
          <td mat-cell *matCellDef="let element"> {{element.endereco.numero}} </td>
        </ng-container>

        <ng-container matColumnDef="cidade">
          <th mat-header-cell *matHeaderCellDef> Cidade </th>
          <td mat-cell *matCellDef="let element"> {{element.endereco.cidade.nome}} -
            {{element.endereco.estado.sigla}}
          </td>
        </ng-container>

        <ng-container matColumnDef="acoes">
          <th mat-header-cell *matHeaderCellDef> Ações </th>
          <td mat-cell *matCellDef="let element"> <button mat-flat-button color="warn" (click)="delete(element.id)">deletar</button>
            <button mat-flat-button color="primary" (click)="editar(element);panel2.expanded = true;"> editar</button>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="headElements"></tr>
        <tr mat-row *matRowDef="let row; columns: headElements;"></tr>
      </table>
      <br><br>
      <mat-card-footer>
        você está na área admisnitrar clientes!
      </mat-card-footer>
    </div>
  </mat-expansion-panel>

  <mat-expansion-panel (opened)="panelOpenState = true" (closed)="panelOpenState = false" #panel2>

    <mat-expansion-panel-header>
      <mat-panel-title>
        Clientes
      </mat-panel-title>
      <mat-panel-description>
        Editar Clientes
      </mat-panel-description>
    </mat-expansion-panel-header>

    <mat-card class="example-card">
      <mat-card-header>
        <mat-card-title>Cliente</mat-card-title>
        <mat-card-subtitle>Atualizar Cliente</mat-card-subtitle>
      </mat-card-header>
      <mat-card-content>

        <form [formGroup]="fg" (ngSubmit)="onSubmit()">

          <p>
            <mat-form-field appearance="standard" class="form-size-field">
              <mat-label>Nome</mat-label>
              <input matInput placeholder="nome" formControlName="nome">
              <mat-icon matSuffix>perm_identity</mat-icon>
              <mat-hint>Entre o nome completo</mat-hint>
            </mat-form-field>
          </p>

          <p>
            <mat-form-field appearance="standard" class="form-size-field">
              <mat-label>Email</mat-label>
              <input matInput placeholder="email" formControlName="email">
              <mat-icon matSuffix>email</mat-icon>
              <mat-hint></mat-hint>
            </mat-form-field>
          </p>

          <p>
            <mat-form-field appearance="standard" class="form-size-field">
              <mat-label>Telefone</mat-label>
              <input matInput placeholder="telefone" formControlName="telefone">
              <mat-icon matSuffix>phone</mat-icon>
              <mat-hint>Entre apenas números!</mat-hint>
            </mat-form-field>
          </p>

          <p>
            <mat-form-field appearance="standard" class="form-size-field">
              <mat-label>Valor</mat-label>
              <input matInput placeholder="valor" formControlName="valor">
              <mat-icon matSuffix>attach_money</mat-icon>
              <mat-hint>Entre somente números separado por ponto!</mat-hint>
            </mat-form-field>
          </p>

          <div formGroupName="endereco">

            <p>
              <mat-form-field appearance="standard" class="form-size-field">
                <mat-label>Cep</mat-label>
                <input matInput placeholder="cep" formControlName="cep" (blur)="consultaCEP()">
                <mat-icon matSuffix>check</mat-icon>
                <mat-hint>Faça busca automática do CEP aqui!</mat-hint>
              </mat-form-field>
            </p>

            <p>
              <mat-form-field appearance="standard" class="form-size-field">
                <mat-label>Rua</mat-label>
                <input matInput placeholder="rua" formControlName="rua">
                <mat-icon matSuffix>check</mat-icon>
                <mat-hint></mat-hint>
              </mat-form-field>
            </p>

            <p>
              <mat-form-field appearance="standard" class="form-size-field">
                <mat-label>Número</mat-label>
                <input matInput placeholder="numero" formControlName="numero">
                <mat-icon matSuffix>check</mat-icon>
                <mat-hint></mat-hint>
              </mat-form-field>
            </p>

            <p>
              <mat-form-field appearance="standard" class="form-size-field">
                <mat-label>Bairro</mat-label>
                <input matInput placeholder="bairro" formControlName="bairro">
                <mat-icon matSuffix>check</mat-icon>
                <mat-hint></mat-hint>
              </mat-form-field>
            </p>

            <p>
              <mat-form-field appearance="standard" class="form-size-field">
                <mat-label>complemento</mat-label>
                <input matInput placeholder="complemento" formControlName="complemento">
                <mat-icon matSuffix>check</mat-icon>
                <mat-hint></mat-hint>
              </mat-form-field>
            </p>
            <p>
              <mat-form-field appearance="standard" class="form-size-field">
                <mat-select placeholder="Escolha um estado" formControlName="estado" (blur)="loadCidades()" (change)="loadCidades()"
                  [compareWith]="compareFn">
                  <mat-option *ngFor="let estado of estados$ | async" [value]="estado">
                    {{estado.nome}}
                  </mat-option>
                </mat-select>
                <mat-icon matSuffix>check</mat-icon>
              </mat-form-field>
            </p>
            <p>
              <mat-form-field appearance="standard" class="form-size-field">
                <mat-select placeholder="Escolha uma cidade" formControlName="cidade" [compareWith]="compareFn">
                  <mat-option *ngFor="let cidade of cidades$ | async" [value]="cidade">
                    {{cidade.nome}}
                  </mat-option>
                </mat-select>
                <mat-icon matSuffix>check</mat-icon>
              </mat-form-field>
            </p>

            <button mat-flat-button color="primary" (click)="panel1.expanded = true;" type="submit">Salvar</button>
            <button mat-flat-button color="warn" type="text" (click)="limparForm();panel1.expanded = true;"> Cancelar
            </button>
          </div>

        </form>
      </mat-card-content>

    </mat-card>

  </mat-expansion-panel>

  <div style="display: none;">
    <div class="container-inside">
      <app-form-debug [form]="fg"></app-form-debug>
    </div>

    <table *ngIf="clientes$ | async as clientes; else loading">
      <thead>
        <tr>
          <th *ngFor="let headItem of headElements"> {{headItem}} </th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let c of clientes">
          <td> {{c.id}} </td>
          <td> {{c.nome}} </td>
          <td> {{c.email}} </td>
          <td> {{c.telefone | phone}} </td>
          <td> {{c.valor | currency:'BRL'}} </td>
          <td> {{c.endereco.cep}} </td>
          <td> {{c.endereco.rua}} </td>
          <td> {{c.endereco.numero}} </td>
          <td> {{c.endereco.cidade.nome}} - {{c.endereco.estado.sigla}}</td>
          <td> <button (click)="delete(c.id)">deletar</button> | <button (click)="editar(c)"> editar</button></td>
        </tr>
      </tbody>
    </table>
    <ng-template #loading>
      <span> Carregando...</span>
    </ng-template>
  </div>

</mat-accordion>
